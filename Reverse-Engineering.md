# Reverse Engineering a Database

> More information on [Reverse Engineering can be found here](https://docs.microsoft.com/ef/core/managing-schemas/scaffolding?tabs=dotnet-core-cli).

First of all, your project will need some new stuff.

```shell
cd WestWind.App
dotnet tool install --global dotnet-ef
dotnet add package Microsoft.EntityFrameworkCore.SqlServer --version 5.0.9
dotnet add package Microsoft.EntityFrameworkCore.Design --version 5.0.9
dotnet build
```

A simple run to reverse engineer an entire database would look like the following. Check the [usage](#dbcontext-scaffold-usage) section below for the help information generated by running `dotnet ef dbcontext scaffold --help`.

```shell
dotnet ef dbcontext scaffold "Server=.;Database=WestWind;Trusted_Connection=true;" Microsoft.EntityFrameworkCore.SqlServer
```

For the current state of the application where the focus is on the `Products`, `Suppliers`, and `Categories`, tables, the following is the complete command to generate the C# code for the DAL and Entity classes.

```shell
cd WestWind.App
dotnet ef dbcontext scaffold "Server=.;Database=WestWind;Trusted_Connection=true;" Microsoft.EntityFrameworkCore.SqlServer --no-build --verbose --context WestWindContext --context-dir DALRE --output-dir EntitiesRE --table Products --table Suppliers --table Categories --data-annotations --namespace WestWind.App.Entities --context-namespace WestWind.App.DAL --force
```

After running this on our existing system, there may be some compiler errors (typically in relationship to Entity properties that have been named slightly differently than what we used - e.g.: `ProductId` instead of `ProductID`).

#### `dbcontext scaffold` Usage

```
Usage: dotnet ef dbcontext scaffold [arguments] [options]

Arguments:
  <CONNECTION>  The connection string to the database.
  <PROVIDER>    The provider to use. (E.g. Microsoft.EntityFrameworkCore.SqlServer)

Options:
  -d|--data-annotations                  Use attributes to configure the model (where possible). If omitted, only the fluent API is used.
  -c|--context <NAME>                    The name of the DbContext. Defaults to the database name.
  --context-dir <PATH>                   The directory to put the DbContext file in. Paths are relative to the project directory.
  -f|--force                             Overwrite existing files.
  -o|--output-dir <PATH>                 The directory to put files in. Paths are relative to the project directory.
  --schema <SCHEMA_NAME>...              The schemas of tables to generate entity types for.
  -t|--table <TABLE_NAME>...             The tables to generate entity types for.
  --use-database-names                   Use table and column names directly from the database.
  --json                                 Show JSON output. Use with --prefix-output to parse programatically.
  -n|--namespace <NAMESPACE>             The namespace to use. Matches the directory by default.
  --context-namespace <NAMESPACE>        The namespace of the DbContext class. Matches the directory by default.
  --no-onconfiguring                     Don't generate DbContext.OnConfiguring.
  --no-pluralize                         Don't use the pluralizer.
  -p|--project <PROJECT>                 The project to use. Defaults to the current working directory.
  -s|--startup-project <PROJECT>         The startup project to use. Defaults to the current working directory.
  --framework <FRAMEWORK>                The target framework. Defaults to the first one in the project.
  --configuration <CONFIGURATION>        The configuration to use.
  --runtime <RUNTIME_IDENTIFIER>         The runtime to use.
  --msbuildprojectextensionspath <PATH>  The MSBuild project extensions path. Defaults to "obj".
  --no-build                             Don't build the project. Intended to be used when the build is up-to-date.
  -h|--help                              Show help information
  -v|--verbose                           Show verbose output.
  --no-color                             Don't colorize output.
  --prefix-output                        Prefix output with level.
  ```
